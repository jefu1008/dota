<!DOCTYPE html>
<html>
  <head>
    <title>手机论坛登录逻辑</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <link href="resources/css/jquery-ui-themes.css" type="text/css" rel="stylesheet"/>
    <link href="resources/css/axure_rp_page.css" type="text/css" rel="stylesheet"/>
    <link href="data/styles.css" type="text/css" rel="stylesheet"/>
    <link href="files/手机论坛登录逻辑/styles.css" type="text/css" rel="stylesheet"/>
    <script src="resources/scripts/jquery-1.7.1.min.js"></script>
    <script src="resources/scripts/jquery-ui-1.8.10.custom.min.js"></script>
    <script src="resources/scripts/axure/axQuery.js"></script>
    <script src="resources/scripts/axure/globals.js"></script>
    <script src="resources/scripts/axutils.js"></script>
    <script src="resources/scripts/axure/annotation.js"></script>
    <script src="resources/scripts/axure/axQuery.std.js"></script>
    <script src="resources/scripts/axure/doc.js"></script>
    <script src="data/document.js"></script>
    <script src="resources/scripts/messagecenter.js"></script>
    <script src="resources/scripts/axure/events.js"></script>
    <script src="resources/scripts/axure/recording.js"></script>
    <script src="resources/scripts/axure/action.js"></script>
    <script src="resources/scripts/axure/expr.js"></script>
    <script src="resources/scripts/axure/geometry.js"></script>
    <script src="resources/scripts/axure/flyout.js"></script>
    <script src="resources/scripts/axure/ie.js"></script>
    <script src="resources/scripts/axure/model.js"></script>
    <script src="resources/scripts/axure/repeater.js"></script>
    <script src="resources/scripts/axure/sto.js"></script>
    <script src="resources/scripts/axure/utils.temp.js"></script>
    <script src="resources/scripts/axure/variables.js"></script>
    <script src="resources/scripts/axure/drag.js"></script>
    <script src="resources/scripts/axure/move.js"></script>
    <script src="resources/scripts/axure/visibility.js"></script>
    <script src="resources/scripts/axure/style.js"></script>
    <script src="resources/scripts/axure/adaptive.js"></script>
    <script src="resources/scripts/axure/tree.js"></script>
    <script src="resources/scripts/axure/init.temp.js"></script>
    <script src="files/手机论坛登录逻辑/data.js"></script>
    <script src="resources/scripts/axure/legacy.js"></script>
    <script src="resources/scripts/axure/viewer.js"></script>
    <script src="resources/scripts/axure/math.js"></script>
    <script type="text/javascript">
      $axure.utils.getTransparentGifPath = function() { return 'resources/images/transparent.gif'; };
      $axure.utils.getOtherPath = function() { return 'resources/Other.html'; };
      $axure.utils.getReloadPath = function() { return 'resources/reload.html'; };
    </script>
  </head>
  <body>
    <div id="base" class="">

      <!-- Unnamed (矩形) -->
      <div id="u5997" class="ax_default _流程形状">
        <div id="u5997_div" class=""></div>
        <!-- Unnamed () -->
        <div id="u5998" class="text" style="visibility: visible;">
          <p><span>APP已登录</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u5999" class="ax_default _流程形状">
        <div id="u5999_div" class=""></div>
        <!-- Unnamed () -->
        <div id="u6000" class="text" style="visibility: visible;">
          <p><span>传递登录信息</span></p><p><span>论坛登录状态</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u6001" class="ax_default _流程形状">
        <div id="u6001_div" class=""></div>
        <!-- Unnamed () -->
        <div id="u6002" class="text" style="visibility: visible;">
          <p><span>论坛已登录状态</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u6003" class="ax_default _流程形状">
        <div id="u6003_div" class=""></div>
        <!-- Unnamed () -->
        <div id="u6004" class="text" style="visibility: visible;">
          <p><span>登出操作</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u6005" class="ax_default _流程形状">
        <div id="u6005_div" class=""></div>
        <!-- Unnamed () -->
        <div id="u6006" class="text" style="visibility: visible;">
          <p><span>APP未登录</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u6007" class="ax_default _流程形状">
        <div id="u6007_div" class=""></div>
        <!-- Unnamed () -->
        <div id="u6008" class="text" style="visibility: visible;">
          <p><span>打开手机版论坛</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u6009" class="ax_default _流程形状">
        <div id="u6009_div" class=""></div>
        <!-- Unnamed () -->
        <div id="u6010" class="text" style="visibility: visible;">
          <p><span>论坛未登录</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u6011" class="ax_default _流程形状">
        <div id="u6011_div" class=""></div>
        <!-- Unnamed () -->
        <div id="u6012" class="text" style="visibility: visible;">
          <p><span>发帖或回复等</span></p><p><span>触发登录操作</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u6013" class="ax_default _流程形状">
        <div id="u6013_div" class=""></div>
        <!-- Unnamed () -->
        <div id="u6014" class="text" style="visibility: visible;">
          <p><span>跳转至APP登录界面</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u6015" class="ax_default _流程形状">
        <div id="u6015_div" class=""></div>
        <!-- Unnamed () -->
        <div id="u6016" class="text" style="visibility: visible;">
          <p><span>登录成功</span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u6017" class="ax_default _流程形状">
        <div id="u6017_div" class=""></div>
        <!-- Unnamed () -->
        <div id="u6018" class="text" style="visibility: visible;">
          <p><span>转回至论坛</span></p>
        </div>
      </div>

      <!-- Unnamed (连接线) -->
      <div id="u6019" class="ax_default _连接线">
        <img id="u6019_seg0" class="img " src="images/手机论坛登录逻辑/u6019_seg0.png" alt="u6019_seg0"/>
        <img id="u6019_seg1" class="img " src="images/手机论坛登录逻辑/u6019_seg1.png" alt="u6019_seg1"/>
        <img id="u6019_seg2" class="img " src="images/手机论坛登录逻辑/u6019_seg2.png" alt="u6019_seg2"/>
        <img id="u6019_seg3" class="img " src="images/手机论坛登录逻辑/u6019_seg3.png" alt="u6019_seg3"/>
        <!-- Unnamed () -->
        <div id="u6020" class="text" style="display: none; visibility: hidden">
          <p><span></span></p>
        </div>
      </div>

      <!-- Unnamed (连接线) -->
      <div id="u6021" class="ax_default _连接线">
        <img id="u6021_seg0" class="img " src="images/手机论坛登录逻辑/u6021_seg0.png" alt="u6021_seg0"/>
        <img id="u6021_seg1" class="img " src="images/手机论坛登录逻辑/u6021_seg1.png" alt="u6021_seg1"/>
        <img id="u6021_seg2" class="img " src="images/手机论坛登录逻辑/u6021_seg2.png" alt="u6021_seg2"/>
        <img id="u6021_seg3" class="img " src="images/手机论坛登录逻辑/u6021_seg3.png" alt="u6021_seg3"/>
        <!-- Unnamed () -->
        <div id="u6022" class="text" style="display: none; visibility: hidden">
          <p><span></span></p>
        </div>
      </div>

      <!-- Unnamed (连接线) -->
      <div id="u6023" class="ax_default _连接线">
        <img id="u6023_seg0" class="img " src="images/手机论坛登录逻辑/u6023_seg0.png" alt="u6023_seg0"/>
        <img id="u6023_seg1" class="img " src="images/手机论坛登录逻辑/u6023_seg1.png" alt="u6023_seg1"/>
        <!-- Unnamed () -->
        <div id="u6024" class="text" style="display: none; visibility: hidden">
          <p><span></span></p>
        </div>
      </div>

      <!-- Unnamed (连接线) -->
      <div id="u6025" class="ax_default _连接线">
        <img id="u6025_seg0" class="img " src="images/手机论坛登录逻辑/u6023_seg0.png" alt="u6025_seg0"/>
        <img id="u6025_seg1" class="img " src="images/手机论坛登录逻辑/u6023_seg1.png" alt="u6025_seg1"/>
        <!-- Unnamed () -->
        <div id="u6026" class="text" style="display: none; visibility: hidden">
          <p><span></span></p>
        </div>
      </div>

      <!-- Unnamed (连接线) -->
      <div id="u6027" class="ax_default _连接线">
        <img id="u6027_seg0" class="img " src="images/手机论坛登录逻辑/u6023_seg0.png" alt="u6027_seg0"/>
        <img id="u6027_seg1" class="img " src="images/手机论坛登录逻辑/u6023_seg1.png" alt="u6027_seg1"/>
        <!-- Unnamed () -->
        <div id="u6028" class="text" style="display: none; visibility: hidden">
          <p><span></span></p>
        </div>
      </div>

      <!-- Unnamed (连接线) -->
      <div id="u6029" class="ax_default _连接线">
        <img id="u6029_seg0" class="img " src="images/手机论坛登录逻辑/u6023_seg0.png" alt="u6029_seg0"/>
        <img id="u6029_seg1" class="img " src="images/手机论坛登录逻辑/u6023_seg1.png" alt="u6029_seg1"/>
        <!-- Unnamed () -->
        <div id="u6030" class="text" style="display: none; visibility: hidden">
          <p><span></span></p>
        </div>
      </div>

      <!-- Unnamed (连接线) -->
      <div id="u6031" class="ax_default _连接线">
        <img id="u6031_seg0" class="img " src="images/手机论坛登录逻辑/u6023_seg0.png" alt="u6031_seg0"/>
        <img id="u6031_seg1" class="img " src="images/手机论坛登录逻辑/u6023_seg1.png" alt="u6031_seg1"/>
        <!-- Unnamed () -->
        <div id="u6032" class="text" style="display: none; visibility: hidden">
          <p><span></span></p>
        </div>
      </div>

      <!-- Unnamed (连接线) -->
      <div id="u6033" class="ax_default _连接线">
        <img id="u6033_seg0" class="img " src="images/手机论坛登录逻辑/u6033_seg0.png" alt="u6033_seg0"/>
        <img id="u6033_seg1" class="img " src="images/手机论坛登录逻辑/u6033_seg1.png" alt="u6033_seg1"/>
        <img id="u6033_seg2" class="img " src="images/手机论坛登录逻辑/u6033_seg2.png" alt="u6033_seg2"/>
        <img id="u6033_seg3" class="img " src="images/手机论坛登录逻辑/u6033_seg3.png" alt="u6033_seg3"/>
        <!-- Unnamed () -->
        <div id="u6034" class="text" style="display: none; visibility: hidden">
          <p><span></span></p>
        </div>
      </div>

      <!-- Unnamed (连接线) -->
      <div id="u6035" class="ax_default _连接线">
        <img id="u6035_seg0" class="img " src="images/手机论坛登录逻辑/u6023_seg0.png" alt="u6035_seg0"/>
        <img id="u6035_seg1" class="img " src="images/手机论坛登录逻辑/u6023_seg1.png" alt="u6035_seg1"/>
        <!-- Unnamed () -->
        <div id="u6036" class="text" style="display: none; visibility: hidden">
          <p><span></span></p>
        </div>
      </div>

      <!-- Unnamed (连接线) -->
      <div id="u6037" class="ax_default _连接线">
        <img id="u6037_seg0" class="img " src="images/手机论坛登录逻辑/u6023_seg0.png" alt="u6037_seg0"/>
        <img id="u6037_seg1" class="img " src="images/手机论坛登录逻辑/u6023_seg1.png" alt="u6037_seg1"/>
        <!-- Unnamed () -->
        <div id="u6038" class="text" style="display: none; visibility: hidden">
          <p><span></span></p>
        </div>
      </div>

      <!-- Unnamed (连接线) -->
      <div id="u6039" class="ax_default _连接线">
        <img id="u6039_seg0" class="img " src="images/手机论坛登录逻辑/u6023_seg0.png" alt="u6039_seg0"/>
        <img id="u6039_seg1" class="img " src="images/手机论坛登录逻辑/u6023_seg1.png" alt="u6039_seg1"/>
        <!-- Unnamed () -->
        <div id="u6040" class="text" style="display: none; visibility: hidden">
          <p><span></span></p>
        </div>
      </div>

      <!-- Unnamed (连接线) -->
      <div id="u6041" class="ax_default _连接线">
        <img id="u6041_seg0" class="img " src="images/手机论坛登录逻辑/u6041_seg0.png" alt="u6041_seg0"/>
        <img id="u6041_seg1" class="img " src="images/手机论坛登录逻辑/u6041_seg1.png" alt="u6041_seg1"/>
        <img id="u6041_seg2" class="img " src="images/手机论坛登录逻辑/u6041_seg2.png" alt="u6041_seg2"/>
        <img id="u6041_seg3" class="img " src="images/手机论坛登录逻辑/u6041_seg3.png" alt="u6041_seg3"/>
        <!-- Unnamed () -->
        <div id="u6042" class="text" style="display: none; visibility: hidden">
          <p><span></span></p>
        </div>
      </div>

      <!-- Unnamed (矩形) -->
      <div id="u6043" class="ax_default _文本段落">
        <div id="u6043_div" class=""></div>
        <!-- Unnamed () -->
        <div id="u6044" class="text" style="visibility: visible;">
          <p><span>论坛登录需要获取ticket</span></p><p><span><br></span></p><p><span>&nbsp;ticket获取方式：</span></p><p><span>首先调用登录接口，获取到token之后，调用&nbsp; /oauth/ticket接口</span></p><p><span>参数：</span></p><p><span>username&nbsp; &nbsp; &nbsp; 完美通行证账号</span></p><p><span>token&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; token</span></p><p><span>toappid&nbsp; &nbsp; &nbsp;&nbsp; 使用的appid</span></p><p><span><br></span></p><p><span>返回数据里面包含了ticket</span></p><p><span><br></span></p><p><span>#define FORUM_URL&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @&quot;http://bbs.dota2.com.cn/forum.php&quot;</span></p><p><span>#define SSO_URL&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @&quot;http://passport.wanmei.com/sso/login&quot;</span></p><p><span>#define SSO_LOGIN_URL&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @&quot;http://passport.wanmei.com/sso/login?continue=http%3A%2F%2Fbbs.dota2.com.cn%2Fsso_callback.php&amp;service=bbsdota2&amp;location=7b2263616c6c6261636b223a22706c7567696e2e7068703f69643d77616e6d656973736f266d6f62696c653d6e6f266974656d3d73736f266d796d6f643d73736f266d7961633d6c6f67696e6564222c2272656665726572223a22666f72756d2e7068703f6d6f62696c653d796573227d&quot;</span></p><p><span>#define SSO_LOGOUT_URL&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @&quot;http://passport.wanmei.com/sso/accounts/LogoutAllService&quot;</span></p><p><span><br></span></p><p><span>地址说明：</span></p><p><span>第一个地址是目前dota2论坛的地址，用这个地址来判断网页展示的是否是论坛</span></p><p><span>第二个地址是打开论坛之后，用户点击登录，网页跳转的地址，拦截下这个请求，打开app登录页面</span></p><p><span>第三个是论坛登录的地址，app登陆成功之后，获取ticket，这个地址后面添加上account=…&amp;ticket=…，用web view加载已添加参数的地址，可跳转回论坛页面，显示已登录用户，（如 http://passport.wanmei.com/sso/login?continue=http%3A%2F%2Fbbs.dota2.com.cn%2Fsso_callback.php&amp;service=bbsdota2&amp;location=7b2263616c6c6261636b223a22706c7567696e2e7068703f69643d77616e6d656973736f266d6f62696c653d6e6f266974656d3d73736f266d796d6f643d73736f266d7961633d6c6f67696e6564222c2272656665726572223a22666f72756d2e7068703f6d6f62696c653d796573227d&amp;account=taoyeskkkks&amp;ticket=123123123123123）</span></p><p><span>第四个是在论坛内点击退出，网页跳转的地址，拦截这个请求，在app内退出当前登录的账号</span></p><p><span>在”我的“页面点击注销之后，需要同时清除 bbs.dota2.com.cn这个域名的cookie，保证再次进入论坛处于未登录状态</span></p><p><span><br></span></p>
        </div>
      </div>
    </div>
  </body>
</html>
